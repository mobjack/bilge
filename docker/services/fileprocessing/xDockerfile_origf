FROM debian:bullseye-slim

RUN apk add --update \
    samba-common-tools \
    samba-client \
    samba-server \
    g++ \
    python3 \
    py3-pip \
    && rm -rf /var/cache/apk/*

EXPOSE 445/tcp

COPY entrypoint.sh smb.conf /
COPY file_processing/ /file_processing

# Python
ENV VIRTUAL_ENV=/file_processing/venv
RUN python3 -m venv $VIRTUAL_ENV
ENV PATH="$VIRTUAL_ENV_/bin:$PATH"
RUN pip install -r /file_processing/bin/requirements.txt

#ENTRYPOINT ["smbd", "--foreground", "--debug-stdout", "--debuglevel=1"]
ENTRYPOINT ["/entrypoint.sh"]
CMD ["smbd"]
